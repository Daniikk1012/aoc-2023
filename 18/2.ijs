0 0$1!:2&2{{
    for_l. y do.
        i =. l_index
        'd a' =. l
        y =. (d,a+(1=4|d-{.(<:i){y)-1=4|d-{.((#y)|>:i){y)i}y
    end.
    y =. +/\({:*(0 1,1 0,0 _1,:_1 0){~{.)"1 y
    ps =. /:~~.{."1 y
    y =. ({:@,,[:/:~{."1)"2(#~([:=/{:"1)"2)2]\0,y
    +/,(2-~/\ps)*}:ps(_2-/\[:\:~{."1@]#~((1&{@]<:[)*.[<2&{@])"1)"0 _ y
}}({:,&".'16b',}:)@(i.&'#'}.@}.}:);.(_2)1!:1<'input'
